{"ast":null,"code":"const _ = require('lodash');\nconst {\n  JWT\n} = require('google-auth-library');\nconst Axios = require('axios');\nconst GoogleSpreadsheetWorksheet = require('./GoogleSpreadsheetWorksheet');\nconst {\n  getFieldMask\n} = require('./utils');\nconst GOOGLE_AUTH_SCOPES = ['https://www.googleapis.com/auth/spreadsheets'\n\n// the list from the sheets v4 auth for spreadsheets.get\n// 'https://www.googleapis.com/auth/drive',\n// 'https://www.googleapis.com/auth/drive.readonly',\n// 'https://www.googleapis.com/auth/drive.file',\n// 'https://www.googleapis.com/auth/spreadsheets',\n// 'https://www.googleapis.com/auth/spreadsheets.readonly',\n];\n\nconst AUTH_MODES = {\n  JWT: 'JWT',\n  API_KEY: 'API_KEY',\n  RAW_ACCESS_TOKEN: 'RAW_ACCESS_TOKEN',\n  OAUTH: 'OAUTH'\n};\nclass GoogleSpreadsheet {\n  constructor(sheetId) {\n    this.spreadsheetId = sheetId;\n    this.authMode = null;\n    this._rawSheets = {};\n    this._rawProperties = null;\n    this._spreadsheetUrl = null;\n\n    // create an axios instance with sheet root URL and interceptors to handle auth\n    this.axios = Axios.create({\n      baseURL: `https://sheets.googleapis.com/v4/spreadsheets/${sheetId || ''}`,\n      // send arrays in params with duplicate keys - ie `?thing=1&thing=2` vs `?thing[]=1...`\n      // solution taken from https://github.com/axios/axios/issues/604\n      paramsSerializer(params) {\n        let options = '';\n        _.keys(params).forEach(key => {\n          const isParamTypeObject = typeof params[key] === 'object';\n          const isParamTypeArray = isParamTypeObject && params[key].length >= 0;\n          if (!isParamTypeObject) options += `${key}=${encodeURIComponent(params[key])}&`;\n          if (isParamTypeObject && isParamTypeArray) {\n            _.each(params[key], val => {\n              options += `${key}=${encodeURIComponent(val)}&`;\n            });\n          }\n        });\n        return options ? options.slice(0, -1) : options;\n      }\n    });\n    // have to use bind here or the functions dont have access to `this` :(\n    this.axios.interceptors.request.use(this._setAxiosRequestAuth.bind(this));\n    this.axios.interceptors.response.use(this._handleAxiosResponse.bind(this), this._handleAxiosErrors.bind(this));\n    return this;\n  }\n\n  // CREATE NEW DOC ////////////////////////////////////////////////////////////////////////////////\n  async createNewSpreadsheetDocument(properties) {\n    // see updateProperties for more info about available properties\n\n    if (this.spreadsheetId) {\n      throw new Error('Only call `createNewSpreadsheetDocument()` on a GoogleSpreadsheet object that has no spreadsheetId set');\n    }\n    const response = await this.axios.post(this.url, {\n      properties\n    });\n    this.spreadsheetId = response.data.spreadsheetId;\n    this.axios.defaults.baseURL += this.spreadsheetId;\n    this._rawProperties = response.data.properties;\n    _.each(response.data.sheets, s => this._updateOrCreateSheet(s));\n  }\n\n  // AUTH RELATED FUNCTIONS ////////////////////////////////////////////////////////////////////////\n  async useApiKey(key) {\n    this.authMode = AUTH_MODES.API_KEY;\n    this.apiKey = key;\n  }\n\n  // token must be created and managed (refreshed) elsewhere\n  async useRawAccessToken(token) {\n    this.authMode = AUTH_MODES.RAW_ACCESS_TOKEN;\n    this.accessToken = token;\n  }\n  async useOAuth2Client(oAuth2Client) {\n    this.authMode = AUTH_MODES.OAUTH;\n    this.oAuth2Client = oAuth2Client;\n  }\n\n  // creds should be an object obtained by loading the json file google gives you\n  // impersonateAs is an email of any user in the G Suite domain\n  // (only works if service account has domain-wide delegation enabled)\n  async useServiceAccountAuth(creds) {\n    let impersonateAs = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    this.jwtClient = new JWT({\n      email: creds.client_email,\n      key: creds.private_key,\n      scopes: GOOGLE_AUTH_SCOPES,\n      subject: impersonateAs\n    });\n    await this.renewJwtAuth();\n  }\n  async renewJwtAuth() {\n    this.authMode = AUTH_MODES.JWT;\n    await this.jwtClient.authorize();\n    /*\n    returned token looks like\n      {\n        access_token: 'secret-token...',\n        token_type: 'Bearer',\n        expiry_date: 1576005020000,\n        id_token: undefined,\n        refresh_token: 'jwt-placeholder'\n      }\n    */\n  }\n\n  // TODO: provide mechanism to share single JWT auth between docs?\n\n  // INTERNAL UTILITY FUNCTIONS ////////////////////////////////////////////////////////////////////\n  async _setAxiosRequestAuth(config) {\n    // TODO: check auth mode, if valid, renew if expired, etc\n    if (this.authMode === AUTH_MODES.JWT) {\n      if (!this.jwtClient) throw new Error('JWT auth is not set up properly');\n      // this seems to do the right thing and only renew the token if expired\n      await this.jwtClient.authorize();\n      config.headers.Authorization = `Bearer ${this.jwtClient.credentials.access_token}`;\n    } else if (this.authMode === AUTH_MODES.RAW_ACCESS_TOKEN) {\n      if (!this.accessToken) throw new Error('Invalid access token');\n      config.headers.Authorization = `Bearer ${this.accessToken}`;\n    } else if (this.authMode === AUTH_MODES.API_KEY) {\n      if (!this.apiKey) throw new Error('Please set API key');\n      config.params = config.params || {};\n      config.params.key = this.apiKey;\n    } else if (this.authMode === AUTH_MODES.OAUTH) {\n      const credentials = await this.oAuth2Client.getAccessToken();\n      config.headers.Authorization = `Bearer ${credentials.token}`;\n    } else {\n      throw new Error('You must initialize some kind of auth before making any requests');\n    }\n    return config;\n  }\n  async _handleAxiosResponse(response) {\n    return response;\n  }\n  async _handleAxiosErrors(error) {\n    // console.log(error);\n    if (error.response && error.response.data) {\n      // usually the error has a code and message, but occasionally not\n      if (!error.response.data.error) throw error;\n      const {\n        code,\n        message\n      } = error.response.data.error;\n      error.message = `Google API error - [${code}] ${message}`;\n      throw error;\n    }\n    if (_.get(error, 'response.status') === 403) {\n      if (this.authMode === AUTH_MODES.API_KEY) {\n        throw new Error('Sheet is private. Use authentication or make public. (see https://github.com/theoephraim/node-google-spreadsheet#a-note-on-authentication for details)');\n      }\n    }\n    throw error;\n  }\n  async _makeSingleUpdateRequest(requestType, requestParams) {\n    const response = await this.axios.post(':batchUpdate', {\n      requests: [{\n        [requestType]: requestParams\n      }],\n      includeSpreadsheetInResponse: true\n      // responseRanges: [string]\n      // responseIncludeGridData: true\n    });\n\n    this._updateRawProperties(response.data.updatedSpreadsheet.properties);\n    _.each(response.data.updatedSpreadsheet.sheets, s => this._updateOrCreateSheet(s));\n    // console.log('API RESPONSE', response.data.replies[0][requestType]);\n    return response.data.replies[0][requestType];\n  }\n  async _makeBatchUpdateRequest(requests, responseRanges) {\n    // this is used for updating batches of cells\n    const response = await this.axios.post(':batchUpdate', {\n      requests,\n      includeSpreadsheetInResponse: true,\n      ...(responseRanges && {\n        responseIncludeGridData: true,\n        ...(responseRanges !== '*' && {\n          responseRanges\n        })\n      })\n    });\n    this._updateRawProperties(response.data.updatedSpreadsheet.properties);\n    _.each(response.data.updatedSpreadsheet.sheets, s => this._updateOrCreateSheet(s));\n  }\n  _ensureInfoLoaded() {\n    if (!this._rawProperties) throw new Error('You must call `doc.loadInfo()` before accessing this property');\n  }\n  _updateRawProperties(newProperties) {\n    this._rawProperties = newProperties;\n  }\n  _updateOrCreateSheet(_ref) {\n    let {\n      properties,\n      data\n    } = _ref;\n    const {\n      sheetId\n    } = properties;\n    if (!this._rawSheets[sheetId]) {\n      this._rawSheets[sheetId] = new GoogleSpreadsheetWorksheet(this, {\n        properties,\n        data\n      });\n    } else {\n      this._rawSheets[sheetId]._rawProperties = properties;\n      this._rawSheets[sheetId]._fillCellData(data);\n    }\n  }\n\n  // BASIC PROPS //////////////////////////////////////////////////////////////////////////////\n  _getProp(param) {\n    this._ensureInfoLoaded();\n    return this._rawProperties[param];\n  }\n  _setProp(param, newVal) {\n    // eslint-disable-line no-unused-vars\n    throw new Error('Do not update directly - use `updateProperties()`');\n  }\n  get title() {\n    return this._getProp('title');\n  }\n  get locale() {\n    return this._getProp('locale');\n  }\n  get timeZone() {\n    return this._getProp('timeZone');\n  }\n  get autoRecalc() {\n    return this._getProp('autoRecalc');\n  }\n  get defaultFormat() {\n    return this._getProp('defaultFormat');\n  }\n  get spreadsheetTheme() {\n    return this._getProp('spreadsheetTheme');\n  }\n  get iterativeCalculationSettings() {\n    return this._getProp('iterativeCalculationSettings');\n  }\n  set title(newVal) {\n    this._setProp('title', newVal);\n  }\n  set locale(newVal) {\n    this._setProp('locale', newVal);\n  }\n  set timeZone(newVal) {\n    this._setProp('timeZone', newVal);\n  }\n  set autoRecalc(newVal) {\n    this._setProp('autoRecalc', newVal);\n  }\n  set defaultFormat(newVal) {\n    this._setProp('defaultFormat', newVal);\n  }\n  set spreadsheetTheme(newVal) {\n    this._setProp('spreadsheetTheme', newVal);\n  }\n  set iterativeCalculationSettings(newVal) {\n    this._setProp('iterativeCalculationSettings', newVal);\n  }\n  async updateProperties(properties) {\n    // updateSpreadsheetProperties\n    // https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets#SpreadsheetProperties\n\n    /*\n      title (string) - title of the spreadsheet\n      locale (string) - ISO code\n      autoRecalc (enum) - ON_CHANGE|MINUTE|HOUR\n      timeZone (string) - timezone code\n      iterativeCalculationSettings (object) - see https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets#IterativeCalculationSettings\n     */\n\n    await this._makeSingleUpdateRequest('updateSpreadsheetProperties', {\n      properties,\n      fields: getFieldMask(properties)\n    });\n  }\n\n  // BASIC INFO ////////////////////////////////////////////////////////////////////////////////////\n  async loadInfo(includeCells) {\n    const response = await this.axios.get('/', {\n      params: {\n        ...(includeCells && {\n          includeGridData: true\n        })\n      }\n    });\n    this._spreadsheetUrl = response.data.spreadsheetUrl;\n    this._rawProperties = response.data.properties;\n    _.each(response.data.sheets, s => this._updateOrCreateSheet(s));\n  }\n  async getInfo() {\n    return this.loadInfo();\n  } // alias to mimic old version\n\n  resetLocalCache() {\n    this._rawProperties = null;\n    this._rawSheets = {};\n  }\n\n  // WORKSHEETS ////////////////////////////////////////////////////////////////////////////////////\n  get sheetCount() {\n    this._ensureInfoLoaded();\n    return _.values(this._rawSheets).length;\n  }\n  get sheetsById() {\n    this._ensureInfoLoaded();\n    return this._rawSheets;\n  }\n  get sheetsByIndex() {\n    this._ensureInfoLoaded();\n    return _.sortBy(this._rawSheets, 'index');\n  }\n  get sheetsByTitle() {\n    this._ensureInfoLoaded();\n    return _.keyBy(this._rawSheets, 'title');\n  }\n  async addSheet() {\n    let properties = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    // Request type = `addSheet`\n    // https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets/request#AddSheetRequest\n\n    const response = await this._makeSingleUpdateRequest('addSheet', {\n      properties: _.omit(properties, 'headers', 'headerValues', 'headerRowIndex')\n    });\n    // _makeSingleUpdateRequest already adds the sheet\n    const newSheetId = response.properties.sheetId;\n    const newSheet = this.sheetsById[newSheetId];\n\n    // allow it to work with `.headers` but `.headerValues` is the real prop\n    const headers = properties.headerValues || properties.headers;\n    if (headers) {\n      await newSheet.setHeaderRow(headers, properties.headerRowIndex);\n    }\n    return newSheet;\n  }\n  async addWorksheet(properties) {\n    return this.addSheet(properties);\n  } // alias to mimic old version\n\n  async deleteSheet(sheetId) {\n    // Request type = `deleteSheet`\n    // https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets/request#DeleteSheetRequest\n    await this._makeSingleUpdateRequest('deleteSheet', {\n      sheetId\n    });\n    delete this._rawSheets[sheetId];\n  }\n\n  // NAMED RANGES //////////////////////////////////////////////////////////////////////////////////\n  async addNamedRange(name, range, namedRangeId) {\n    // namedRangeId is optional\n    return this._makeSingleUpdateRequest('addNamedRange', {\n      name,\n      range,\n      namedRangeId\n    });\n  }\n  async deleteNamedRange(namedRangeId) {\n    return this._makeSingleUpdateRequest('deleteNamedRange', {\n      namedRangeId\n    });\n  }\n\n  // LOADING CELLS /////////////////////////////////////////////////////////////////////////////////\n  async loadCells(filters) {\n    // you can pass in a single filter or an array of filters\n    // strings are treated as a1 ranges\n    // objects are treated as GridRange objects\n    // TODO: make it support DeveloperMetadataLookup objects\n\n    // TODO: switch to this mode if using a read-only auth token?\n    const readOnlyMode = this.authMode === AUTH_MODES.API_KEY;\n    const filtersArray = _.isArray(filters) ? filters : [filters];\n    const dataFilters = _.map(filtersArray, filter => {\n      if (_.isString(filter)) {\n        return readOnlyMode ? filter : {\n          a1Range: filter\n        };\n      }\n      if (_.isObject(filter)) {\n        if (readOnlyMode) {\n          throw new Error('Only A1 ranges are supported when fetching cells with read-only access (using only an API key)');\n        }\n        // TODO: make this support Developer Metadata filters\n        return {\n          gridRange: filter\n        };\n      }\n      throw new Error('Each filter must be an A1 range string or a gridrange object');\n    });\n    let result;\n    // when using an API key only, we must use the regular get endpoint\n    // because :getByDataFilter requires higher access\n    if (this.authMode === AUTH_MODES.API_KEY) {\n      result = await this.axios.get('/', {\n        params: {\n          includeGridData: true,\n          ranges: dataFilters\n        }\n      });\n      // otherwise we use the getByDataFilter endpoint because it is more flexible\n    } else {\n      result = await this.axios.post(':getByDataFilter', {\n        includeGridData: true,\n        dataFilters\n      });\n    }\n    const {\n      sheets\n    } = result.data;\n    _.each(sheets, sheet => {\n      this._updateOrCreateSheet(sheet);\n    });\n  }\n\n  // EXPORTING /////////////////////////////////////////////////////////////\n  async _downloadAs(fileType, worksheetId, returnStreamInsteadOfBuffer) {\n    // see https://stackoverflow.com/questions/11619805/using-the-google-drive-api-to-download-a-spreadsheet-in-csv-format/51235960#51235960\n\n    if (['html', 'xlsx', 'ods'].includes(fileType)) {\n      if (worksheetId) throw new Error(`Cannot specify worksheetId when exporting as ${fileType}`);\n    } else if (['csv', 'tsv', 'pdf'].includes(fileType)) {\n      if (worksheetId === undefined) throw new Error(`Must specify worksheetId when exporting as ${fileType}`);\n    } else {\n      throw new Error(`unsupported export fileType - ${fileType}`);\n    }\n\n    // google UI shows \"html\" but passes through \"zip\"\n    if (fileType === 'html') fileType = 'zip';\n    const exportUrl = this._spreadsheetUrl.replace('/edit', '/export');\n    const response = await this.axios.get(exportUrl, {\n      baseUrl: '',\n      // unset baseUrl since we're not hitting the normal sheets API\n      params: {\n        id: this.spreadsheetId,\n        format: fileType,\n        ...(worksheetId && {\n          gid: worksheetId\n        })\n      },\n      responseType: returnStreamInsteadOfBuffer ? 'stream' : 'arraybuffer'\n    });\n    return response.data;\n  }\n  async downloadAsHTML() {\n    let returnStreamInsteadOfBuffer = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    return this._downloadAs('html', null, returnStreamInsteadOfBuffer);\n  }\n  async downloadAsXLSX() {\n    let returnStreamInsteadOfBuffer = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    return this._downloadAs('xlsx', null, returnStreamInsteadOfBuffer);\n  }\n  async downloadAsODS() {\n    let returnStreamInsteadOfBuffer = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    return this._downloadAs('ods', null, returnStreamInsteadOfBuffer);\n  }\n}\nmodule.exports = GoogleSpreadsheet;","map":{"version":3,"names":["_","require","JWT","Axios","GoogleSpreadsheetWorksheet","getFieldMask","GOOGLE_AUTH_SCOPES","AUTH_MODES","API_KEY","RAW_ACCESS_TOKEN","OAUTH","GoogleSpreadsheet","constructor","sheetId","spreadsheetId","authMode","_rawSheets","_rawProperties","_spreadsheetUrl","axios","create","baseURL","paramsSerializer","params","options","keys","forEach","key","isParamTypeObject","isParamTypeArray","length","encodeURIComponent","each","val","slice","interceptors","request","use","_setAxiosRequestAuth","bind","response","_handleAxiosResponse","_handleAxiosErrors","createNewSpreadsheetDocument","properties","Error","post","url","data","defaults","sheets","s","_updateOrCreateSheet","useApiKey","apiKey","useRawAccessToken","token","accessToken","useOAuth2Client","oAuth2Client","useServiceAccountAuth","creds","impersonateAs","jwtClient","email","client_email","private_key","scopes","subject","renewJwtAuth","authorize","config","headers","Authorization","credentials","access_token","getAccessToken","error","code","message","get","_makeSingleUpdateRequest","requestType","requestParams","requests","includeSpreadsheetInResponse","_updateRawProperties","updatedSpreadsheet","replies","_makeBatchUpdateRequest","responseRanges","responseIncludeGridData","_ensureInfoLoaded","newProperties","_fillCellData","_getProp","param","_setProp","newVal","title","locale","timeZone","autoRecalc","defaultFormat","spreadsheetTheme","iterativeCalculationSettings","updateProperties","fields","loadInfo","includeCells","includeGridData","spreadsheetUrl","getInfo","resetLocalCache","sheetCount","values","sheetsById","sheetsByIndex","sortBy","sheetsByTitle","keyBy","addSheet","omit","newSheetId","newSheet","headerValues","setHeaderRow","headerRowIndex","addWorksheet","deleteSheet","addNamedRange","name","range","namedRangeId","deleteNamedRange","loadCells","filters","readOnlyMode","filtersArray","isArray","dataFilters","map","filter","isString","a1Range","isObject","gridRange","result","ranges","sheet","_downloadAs","fileType","worksheetId","returnStreamInsteadOfBuffer","includes","undefined","exportUrl","replace","baseUrl","id","format","gid","responseType","downloadAsHTML","downloadAsXLSX","downloadAsODS","module","exports"],"sources":["/home/arliones/tmp/nosso-ifsc/node_modules/google-spreadsheet/lib/GoogleSpreadsheet.js"],"sourcesContent":["const _ = require('lodash');\nconst { JWT } = require('google-auth-library');\nconst Axios = require('axios');\n\nconst GoogleSpreadsheetWorksheet = require('./GoogleSpreadsheetWorksheet');\nconst { getFieldMask } = require('./utils');\n\nconst GOOGLE_AUTH_SCOPES = [\n  'https://www.googleapis.com/auth/spreadsheets',\n\n  // the list from the sheets v4 auth for spreadsheets.get\n  // 'https://www.googleapis.com/auth/drive',\n  // 'https://www.googleapis.com/auth/drive.readonly',\n  // 'https://www.googleapis.com/auth/drive.file',\n  // 'https://www.googleapis.com/auth/spreadsheets',\n  // 'https://www.googleapis.com/auth/spreadsheets.readonly',\n];\n\nconst AUTH_MODES = {\n  JWT: 'JWT',\n  API_KEY: 'API_KEY',\n  RAW_ACCESS_TOKEN: 'RAW_ACCESS_TOKEN',\n  OAUTH: 'OAUTH',\n};\n\nclass GoogleSpreadsheet {\n  constructor(sheetId) {\n    this.spreadsheetId = sheetId;\n    this.authMode = null;\n    this._rawSheets = {};\n    this._rawProperties = null;\n    this._spreadsheetUrl = null;\n\n    // create an axios instance with sheet root URL and interceptors to handle auth\n    this.axios = Axios.create({\n      baseURL: `https://sheets.googleapis.com/v4/spreadsheets/${sheetId || ''}`,\n      // send arrays in params with duplicate keys - ie `?thing=1&thing=2` vs `?thing[]=1...`\n      // solution taken from https://github.com/axios/axios/issues/604\n      paramsSerializer(params) {\n        let options = '';\n        _.keys(params).forEach((key) => {\n          const isParamTypeObject = typeof params[key] === 'object';\n          const isParamTypeArray = isParamTypeObject && (params[key].length >= 0);\n          if (!isParamTypeObject) options += `${key}=${encodeURIComponent(params[key])}&`;\n          if (isParamTypeObject && isParamTypeArray) {\n            _.each(params[key], (val) => {\n              options += `${key}=${encodeURIComponent(val)}&`;\n            });\n          }\n        });\n        return options ? options.slice(0, -1) : options;\n      },\n    });\n    // have to use bind here or the functions dont have access to `this` :(\n    this.axios.interceptors.request.use(this._setAxiosRequestAuth.bind(this));\n    this.axios.interceptors.response.use(\n      this._handleAxiosResponse.bind(this),\n      this._handleAxiosErrors.bind(this)\n    );\n\n    return this;\n  }\n\n  // CREATE NEW DOC ////////////////////////////////////////////////////////////////////////////////\n  async createNewSpreadsheetDocument(properties) {\n    // see updateProperties for more info about available properties\n\n    if (this.spreadsheetId) {\n      throw new Error('Only call `createNewSpreadsheetDocument()` on a GoogleSpreadsheet object that has no spreadsheetId set');\n    }\n    const response = await this.axios.post(this.url, {\n      properties,\n    });\n    this.spreadsheetId = response.data.spreadsheetId;\n    this.axios.defaults.baseURL += this.spreadsheetId;\n\n    this._rawProperties = response.data.properties;\n    _.each(response.data.sheets, (s) => this._updateOrCreateSheet(s));\n  }\n\n  // AUTH RELATED FUNCTIONS ////////////////////////////////////////////////////////////////////////\n  async useApiKey(key) {\n    this.authMode = AUTH_MODES.API_KEY;\n    this.apiKey = key;\n  }\n\n  // token must be created and managed (refreshed) elsewhere\n  async useRawAccessToken(token) {\n    this.authMode = AUTH_MODES.RAW_ACCESS_TOKEN;\n    this.accessToken = token;\n  }\n\n  async useOAuth2Client(oAuth2Client) {\n    this.authMode = AUTH_MODES.OAUTH;\n    this.oAuth2Client = oAuth2Client;\n  }\n\n  // creds should be an object obtained by loading the json file google gives you\n  // impersonateAs is an email of any user in the G Suite domain\n  // (only works if service account has domain-wide delegation enabled)\n  async useServiceAccountAuth(creds, impersonateAs = null) {\n    this.jwtClient = new JWT({\n      email: creds.client_email,\n      key: creds.private_key,\n      scopes: GOOGLE_AUTH_SCOPES,\n      subject: impersonateAs,\n    });\n    await this.renewJwtAuth();\n  }\n\n  async renewJwtAuth() {\n    this.authMode = AUTH_MODES.JWT;\n    await this.jwtClient.authorize();\n    /*\n    returned token looks like\n      {\n        access_token: 'secret-token...',\n        token_type: 'Bearer',\n        expiry_date: 1576005020000,\n        id_token: undefined,\n        refresh_token: 'jwt-placeholder'\n      }\n    */\n  }\n\n  // TODO: provide mechanism to share single JWT auth between docs?\n\n  // INTERNAL UTILITY FUNCTIONS ////////////////////////////////////////////////////////////////////\n  async _setAxiosRequestAuth(config) {\n    // TODO: check auth mode, if valid, renew if expired, etc\n    if (this.authMode === AUTH_MODES.JWT) {\n      if (!this.jwtClient) throw new Error('JWT auth is not set up properly');\n      // this seems to do the right thing and only renew the token if expired\n      await this.jwtClient.authorize();\n      config.headers.Authorization = `Bearer ${this.jwtClient.credentials.access_token}`;\n    } else if (this.authMode === AUTH_MODES.RAW_ACCESS_TOKEN) {\n      if (!this.accessToken) throw new Error('Invalid access token');\n      config.headers.Authorization = `Bearer ${this.accessToken}`;\n    } else if (this.authMode === AUTH_MODES.API_KEY) {\n      if (!this.apiKey) throw new Error('Please set API key');\n      config.params = config.params || {};\n      config.params.key = this.apiKey;\n    } else if (this.authMode === AUTH_MODES.OAUTH) {\n      const credentials = await this.oAuth2Client.getAccessToken();\n      config.headers.Authorization = `Bearer ${credentials.token}`;\n    } else {\n      throw new Error('You must initialize some kind of auth before making any requests');\n    }\n    return config;\n  }\n\n  async _handleAxiosResponse(response) { return response; }\n  async _handleAxiosErrors(error) {\n    // console.log(error);\n    if (error.response && error.response.data) {\n      // usually the error has a code and message, but occasionally not\n      if (!error.response.data.error) throw error;\n\n      const { code, message } = error.response.data.error;\n      error.message = `Google API error - [${code}] ${message}`;\n      throw error;\n    }\n\n    if (_.get(error, 'response.status') === 403) {\n      if (this.authMode === AUTH_MODES.API_KEY) {\n        throw new Error('Sheet is private. Use authentication or make public. (see https://github.com/theoephraim/node-google-spreadsheet#a-note-on-authentication for details)');\n      }\n    }\n    throw error;\n  }\n\n  async _makeSingleUpdateRequest(requestType, requestParams) {\n    const response = await this.axios.post(':batchUpdate', {\n      requests: [{ [requestType]: requestParams }],\n      includeSpreadsheetInResponse: true,\n      // responseRanges: [string]\n      // responseIncludeGridData: true\n    });\n\n    this._updateRawProperties(response.data.updatedSpreadsheet.properties);\n    _.each(response.data.updatedSpreadsheet.sheets, (s) => this._updateOrCreateSheet(s));\n    // console.log('API RESPONSE', response.data.replies[0][requestType]);\n    return response.data.replies[0][requestType];\n  }\n\n  async _makeBatchUpdateRequest(requests, responseRanges) {\n    // this is used for updating batches of cells\n    const response = await this.axios.post(':batchUpdate', {\n      requests,\n      includeSpreadsheetInResponse: true,\n      ...responseRanges && {\n        responseIncludeGridData: true,\n        ...responseRanges !== '*' && { responseRanges },\n      },\n    });\n\n    this._updateRawProperties(response.data.updatedSpreadsheet.properties);\n    _.each(response.data.updatedSpreadsheet.sheets, (s) => this._updateOrCreateSheet(s));\n  }\n\n  _ensureInfoLoaded() {\n    if (!this._rawProperties) throw new Error('You must call `doc.loadInfo()` before accessing this property');\n  }\n\n  _updateRawProperties(newProperties) { this._rawProperties = newProperties; }\n\n  _updateOrCreateSheet({ properties, data }) {\n    const { sheetId } = properties;\n    if (!this._rawSheets[sheetId]) {\n      this._rawSheets[sheetId] = new GoogleSpreadsheetWorksheet(this, { properties, data });\n    } else {\n      this._rawSheets[sheetId]._rawProperties = properties;\n      this._rawSheets[sheetId]._fillCellData(data);\n    }\n  }\n\n  // BASIC PROPS //////////////////////////////////////////////////////////////////////////////\n  _getProp(param) {\n    this._ensureInfoLoaded();\n    return this._rawProperties[param];\n  }\n  _setProp(param, newVal) { // eslint-disable-line no-unused-vars\n    throw new Error('Do not update directly - use `updateProperties()`');\n  }\n\n  get title() { return this._getProp('title'); }\n  get locale() { return this._getProp('locale'); }\n  get timeZone() { return this._getProp('timeZone'); }\n  get autoRecalc() { return this._getProp('autoRecalc'); }\n  get defaultFormat() { return this._getProp('defaultFormat'); }\n  get spreadsheetTheme() { return this._getProp('spreadsheetTheme'); }\n  get iterativeCalculationSettings() { return this._getProp('iterativeCalculationSettings'); }\n\n  set title(newVal) { this._setProp('title', newVal); }\n  set locale(newVal) { this._setProp('locale', newVal); }\n  set timeZone(newVal) { this._setProp('timeZone', newVal); }\n  set autoRecalc(newVal) { this._setProp('autoRecalc', newVal); }\n  set defaultFormat(newVal) { this._setProp('defaultFormat', newVal); }\n  set spreadsheetTheme(newVal) { this._setProp('spreadsheetTheme', newVal); }\n  set iterativeCalculationSettings(newVal) { this._setProp('iterativeCalculationSettings', newVal); }\n\n  async updateProperties(properties) {\n    // updateSpreadsheetProperties\n    // https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets#SpreadsheetProperties\n\n    /*\n      title (string) - title of the spreadsheet\n      locale (string) - ISO code\n      autoRecalc (enum) - ON_CHANGE|MINUTE|HOUR\n      timeZone (string) - timezone code\n      iterativeCalculationSettings (object) - see https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets#IterativeCalculationSettings\n     */\n\n    await this._makeSingleUpdateRequest('updateSpreadsheetProperties', {\n      properties,\n      fields: getFieldMask(properties),\n    });\n  }\n\n  // BASIC INFO ////////////////////////////////////////////////////////////////////////////////////\n  async loadInfo(includeCells) {\n    const response = await this.axios.get('/', {\n      params: {\n        ...includeCells && { includeGridData: true },\n      },\n    });\n    this._spreadsheetUrl = response.data.spreadsheetUrl;\n    this._rawProperties = response.data.properties;\n    _.each(response.data.sheets, (s) => this._updateOrCreateSheet(s));\n  }\n  async getInfo() { return this.loadInfo(); } // alias to mimic old version\n\n  resetLocalCache() {\n    this._rawProperties = null;\n    this._rawSheets = {};\n  }\n\n  // WORKSHEETS ////////////////////////////////////////////////////////////////////////////////////\n  get sheetCount() {\n    this._ensureInfoLoaded();\n    return _.values(this._rawSheets).length;\n  }\n\n  get sheetsById() {\n    this._ensureInfoLoaded();\n    return this._rawSheets;\n  }\n\n  get sheetsByIndex() {\n    this._ensureInfoLoaded();\n    return _.sortBy(this._rawSheets, 'index');\n  }\n\n  get sheetsByTitle() {\n    this._ensureInfoLoaded();\n    return _.keyBy(this._rawSheets, 'title');\n  }\n\n  async addSheet(properties = {}) {\n    // Request type = `addSheet`\n    // https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets/request#AddSheetRequest\n\n    const response = await this._makeSingleUpdateRequest('addSheet', {\n      properties: _.omit(properties, 'headers', 'headerValues', 'headerRowIndex'),\n    });\n    // _makeSingleUpdateRequest already adds the sheet\n    const newSheetId = response.properties.sheetId;\n    const newSheet = this.sheetsById[newSheetId];\n\n    // allow it to work with `.headers` but `.headerValues` is the real prop\n    const headers = properties.headerValues || properties.headers;\n    if (headers) {\n      await newSheet.setHeaderRow(headers, properties.headerRowIndex);\n    }\n\n    return newSheet;\n  }\n  async addWorksheet(properties) { return this.addSheet(properties); } // alias to mimic old version\n\n  async deleteSheet(sheetId) {\n    // Request type = `deleteSheet`\n    // https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets/request#DeleteSheetRequest\n    await this._makeSingleUpdateRequest('deleteSheet', { sheetId });\n    delete this._rawSheets[sheetId];\n  }\n\n  // NAMED RANGES //////////////////////////////////////////////////////////////////////////////////\n  async addNamedRange(name, range, namedRangeId) {\n    // namedRangeId is optional\n    return this._makeSingleUpdateRequest('addNamedRange', {\n      name,\n      range,\n      namedRangeId,\n    });\n  }\n\n  async deleteNamedRange(namedRangeId) {\n    return this._makeSingleUpdateRequest('deleteNamedRange', { namedRangeId });\n  }\n\n  // LOADING CELLS /////////////////////////////////////////////////////////////////////////////////\n  async loadCells(filters) {\n    // you can pass in a single filter or an array of filters\n    // strings are treated as a1 ranges\n    // objects are treated as GridRange objects\n    // TODO: make it support DeveloperMetadataLookup objects\n\n    // TODO: switch to this mode if using a read-only auth token?\n    const readOnlyMode = this.authMode === AUTH_MODES.API_KEY;\n\n    const filtersArray = _.isArray(filters) ? filters : [filters];\n    const dataFilters = _.map(filtersArray, (filter) => {\n      if (_.isString(filter)) {\n        return readOnlyMode ? filter : { a1Range: filter };\n      }\n      if (_.isObject(filter)) {\n        if (readOnlyMode) {\n          throw new Error('Only A1 ranges are supported when fetching cells with read-only access (using only an API key)');\n        }\n        // TODO: make this support Developer Metadata filters\n        return { gridRange: filter };\n      }\n      throw new Error('Each filter must be an A1 range string or a gridrange object');\n    });\n\n    let result;\n    // when using an API key only, we must use the regular get endpoint\n    // because :getByDataFilter requires higher access\n    if (this.authMode === AUTH_MODES.API_KEY) {\n      result = await this.axios.get('/', {\n        params: {\n          includeGridData: true,\n          ranges: dataFilters,\n        },\n      });\n    // otherwise we use the getByDataFilter endpoint because it is more flexible\n    } else {\n      result = await this.axios.post(':getByDataFilter', {\n        includeGridData: true,\n        dataFilters,\n      });\n    }\n\n    const { sheets } = result.data;\n    _.each(sheets, (sheet) => { this._updateOrCreateSheet(sheet); });\n  }\n\n  // EXPORTING /////////////////////////////////////////////////////////////\n  async _downloadAs(fileType, worksheetId, returnStreamInsteadOfBuffer) {\n    // see https://stackoverflow.com/questions/11619805/using-the-google-drive-api-to-download-a-spreadsheet-in-csv-format/51235960#51235960\n\n    if (['html', 'xlsx', 'ods'].includes(fileType)) {\n      if (worksheetId) throw new Error(`Cannot specify worksheetId when exporting as ${fileType}`);\n    } else if (['csv', 'tsv', 'pdf'].includes(fileType)) {\n      if (worksheetId === undefined) throw new Error(`Must specify worksheetId when exporting as ${fileType}`);\n    } else {\n      throw new Error(`unsupported export fileType - ${fileType}`);\n    }\n\n    // google UI shows \"html\" but passes through \"zip\"\n    if (fileType === 'html') fileType = 'zip';\n\n    const exportUrl = this._spreadsheetUrl.replace('/edit', '/export');\n    const response = await this.axios.get(exportUrl, {\n      baseUrl: '', // unset baseUrl since we're not hitting the normal sheets API\n      params: {\n        id: this.spreadsheetId,\n        format: fileType,\n        ...worksheetId && { gid: worksheetId },\n      },\n      responseType: returnStreamInsteadOfBuffer ? 'stream' : 'arraybuffer',\n    });\n    return response.data;\n  }\n  async downloadAsHTML(returnStreamInsteadOfBuffer = false) {\n    return this._downloadAs('html', null, returnStreamInsteadOfBuffer);\n  }\n  async downloadAsXLSX(returnStreamInsteadOfBuffer = false) {\n    return this._downloadAs('xlsx', null, returnStreamInsteadOfBuffer);\n  }\n  async downloadAsODS(returnStreamInsteadOfBuffer = false) {\n    return this._downloadAs('ods', null, returnStreamInsteadOfBuffer);\n  }\n}\n\nmodule.exports = GoogleSpreadsheet;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}